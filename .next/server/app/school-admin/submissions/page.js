(()=>{var e={};e.id=4597,e.ids=[4597],e.modules={55403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},94749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},25528:e=>{"use strict";e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{"use strict";e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{"use strict";e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},57310:e=>{"use strict";e.exports=require("url")},9673:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>n.a,__next_app__:()=>h,originalPathname:()=>m,pages:()=>o,routeModule:()=>x,tree:()=>c});var a=t(67096),l=t(16132),i=t(37284),n=t.n(i),r=t(32564),d={};for(let e in r)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>r[e]);t.d(s,d);let c=["",{children:["school-admin",{children:["submissions",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,83085)),"C:\\xampp\\htdocs\\childclub\\childclub-frontend\\src\\app\\school-admin\\submissions\\page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,25803)),"C:\\xampp\\htdocs\\childclub\\childclub-frontend\\src\\app\\school-admin\\layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,79113)),"C:\\xampp\\htdocs\\childclub\\childclub-frontend\\src\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9291,23)),"next/dist/client/components/not-found-error"]}],o=["C:\\xampp\\htdocs\\childclub\\childclub-frontend\\src\\app\\school-admin\\submissions\\page.tsx"],m="/school-admin/submissions/page",h={require:t,loadChunk:()=>Promise.resolve()},x=new a.AppPageRouteModule({definition:{kind:l.x.APP_PAGE,page:"/school-admin/submissions/page",pathname:"/school-admin/submissions",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},89982:(e,s,t)=>{Promise.resolve().then(t.bind(t,67221))},67221:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>SchoolAdminSubmissionsPage});var a=t(30784),l=t(9885),i=t(11440),n=t.n(i),r=t(79803),d=t(39546),c=t(69518),o=t(28626),m=t(18310),h=t(85574),x=t(92032),u=t(48973),b=t(28089),j=t(19300),g=t(85525);function SchoolAdminSubmissionsPage(){let[e,s]=(0,l.useState)([]),[t,i]=(0,l.useState)(!0),[p,N]=(0,l.useState)(""),[v,f]=(0,l.useState)("all"),[w,y]=(0,l.useState)(null),[S,k]=(0,l.useState)(!1),[C,_]=(0,l.useState)(!1),[A,P]=(0,l.useState)(""),[Z,z]=(0,l.useState)(""),[R,T]=(0,l.useState)(""),[F,$]=(0,l.useState)("reviewed");(0,l.useEffect)(()=>{fetchSubmissions()},[]);let fetchSubmissions=async()=>{try{let e=localStorage.getItem("token"),t=JSON.parse(localStorage.getItem("user")||"{}");if(!e)throw Error("No authentication token found");console.log("Fetching submissions for school admin:",t.schoolId);let a=t.schoolId||t.id,l=await fetch(`${g.CT}/submissions/school/${a}`,{headers:{Authorization:`Bearer ${e}`}});if(!l.ok){let e=await l.text();throw console.error("Failed to fetch submissions:",e),Error(`Failed to fetch submissions: ${l.status}`)}let i=await l.json();console.log("Fetched submissions:",i.length),s(i)}catch(e){console.error("Error fetching submissions:",e),j.Z.fire({icon:"error",title:"Error",text:e.message||"Failed to fetch submissions",footer:"Check console for more details"})}finally{i(!1)}},handleViewSubmission=e=>{y(e),k(!0)},handleStartReview=e=>{y(e),P(e.grade?.toString()||""),z(e.feedback||""),T(""),$("submitted"===e.status?"reviewed":e.status),_(!0)},handleSubmitReview=async()=>{if(w){if(!A||0>parseFloat(A)){j.Z.fire({icon:"warning",title:"Invalid Grade",text:"Please enter a valid grade (0 or higher)"});return}if(parseFloat(A)>(w.task?.maxScore||100)){j.Z.fire({icon:"warning",title:"Grade Too High",text:`Grade cannot exceed ${w.task?.maxScore}`});return}if(!Z.trim()){let e=await j.Z.fire({icon:"question",title:"No Feedback",text:"Are you sure you want to submit without feedback?",showCancelButton:!0,confirmButtonText:"Yes, Submit",cancelButtonText:"Cancel"});if(!e.isConfirmed)return}try{let e=localStorage.getItem("token"),s=await fetch(`${g.CT}/submissions/${w.id}/review`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({grade:parseFloat(A),feedback:Z.trim(),teacherNotes:R.trim(),status:F})});if(s.ok)await j.Z.fire({icon:"success",title:"Review Submitted!",text:"Your review has been saved successfully",confirmButtonColor:"#10b981"}),_(!1),k(!1),fetchSubmissions();else throw Error("Failed to submit review")}catch(e){console.error("Error submitting review:",e),j.Z.fire({icon:"error",title:"Error",text:"Failed to submit review. Please try again."})}}},q=e.filter(e=>{let s=e.student?.firstName?.toLowerCase().includes(p.toLowerCase())||e.student?.lastName?.toLowerCase().includes(p.toLowerCase())||e.task?.title?.toLowerCase().includes(p.toLowerCase()),t="all"===v||e.status===v;return s&&t}),getStatusBadge=e=>{let s={draft:{class:"bg-warning",label:"Draft"},submitted:{class:"bg-info",label:"Submitted"},reviewed:{class:"bg-primary",label:"Reviewed"},approved:{class:"bg-success",label:"Approved"},rejected:{class:"bg-danger",label:"Rejected"}},t=s[e]||s.submitted;return a.jsx("span",{className:`badge ${t.class}`,children:t.label})},getTypeBadge=e=>a.jsx("span",{className:`badge ${{assignment:"bg-primary",homework:"bg-success",project:"bg-info",quiz:"bg-warning",exam:"bg-danger"}[e?.toLowerCase()]||"bg-secondary"}`,children:e}),B={total:e.length,submitted:e.filter(e=>"submitted"===e.status).length,reviewed:e.filter(e=>"reviewed"===e.status||"approved"===e.status).length,pending:e.filter(e=>"draft"===e.status).length};return t?a.jsx("div",{className:"container-fluid",children:a.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"400px"},children:a.jsx("div",{className:"spinner-border text-primary",role:"status",children:a.jsx("span",{className:"visually-hidden",children:"Loading..."})})})}):(0,a.jsxs)("div",{className:"container-fluid",children:[a.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:(0,a.jsxs)("div",{className:"d-flex align-items-center",children:[a.jsx(n(),{href:"/school-admin/dashboard",className:"btn btn-outline-secondary me-3",children:a.jsx(r.Z,{size:20})}),(0,a.jsxs)("div",{children:[a.jsx("h1",{className:"h3 mb-0",children:"All Submissions"}),a.jsx("p",{className:"text-muted mb-0",children:"View all student submissions across the school"})]})]})}),(0,a.jsxs)("div",{className:"row g-3 mb-4",children:[a.jsx("div",{className:"col-md-3",children:a.jsx("div",{className:"card border-0 shadow-sm",children:(0,a.jsxs)("div",{className:"card-body text-center",children:[a.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3 mx-auto mb-3",style:{width:"60px",height:"60px"},children:a.jsx(d.Z,{size:24,className:"text-primary"})}),a.jsx("h4",{className:"mb-1",children:B.total}),a.jsx("p",{className:"text-muted mb-0",children:"Total Submissions"})]})})}),a.jsx("div",{className:"col-md-3",children:a.jsx("div",{className:"card border-0 shadow-sm",children:(0,a.jsxs)("div",{className:"card-body text-center",children:[a.jsx("div",{className:"bg-info bg-opacity-10 rounded-circle p-3 mx-auto mb-3",style:{width:"60px",height:"60px"},children:a.jsx(d.Z,{size:24,className:"text-info"})}),a.jsx("h4",{className:"mb-1",children:B.submitted}),a.jsx("p",{className:"text-muted mb-0",children:"Awaiting Review"})]})})}),a.jsx("div",{className:"col-md-3",children:a.jsx("div",{className:"card border-0 shadow-sm",children:(0,a.jsxs)("div",{className:"card-body text-center",children:[a.jsx("div",{className:"bg-success bg-opacity-10 rounded-circle p-3 mx-auto mb-3",style:{width:"60px",height:"60px"},children:a.jsx(d.Z,{size:24,className:"text-success"})}),a.jsx("h4",{className:"mb-1",children:B.reviewed}),a.jsx("p",{className:"text-muted mb-0",children:"Reviewed"})]})})}),a.jsx("div",{className:"col-md-3",children:a.jsx("div",{className:"card border-0 shadow-sm",children:(0,a.jsxs)("div",{className:"card-body text-center",children:[a.jsx("div",{className:"bg-warning bg-opacity-10 rounded-circle p-3 mx-auto mb-3",style:{width:"60px",height:"60px"},children:a.jsx(d.Z,{size:24,className:"text-warning"})}),a.jsx("h4",{className:"mb-1",children:B.pending}),a.jsx("p",{className:"text-muted mb-0",children:"Draft"})]})})})]}),a.jsx("div",{className:"card mb-4",children:a.jsx("div",{className:"card-body",children:(0,a.jsxs)("div",{className:"row g-3",children:[a.jsx("div",{className:"col-md-6",children:(0,a.jsxs)("div",{className:"input-group",children:[a.jsx("span",{className:"input-group-text",children:a.jsx(c.Z,{size:16})}),a.jsx("input",{type:"text",className:"form-control",placeholder:"Search by student name or assignment...",value:p,onChange:e=>N(e.target.value)})]})}),a.jsx("div",{className:"col-md-4",children:(0,a.jsxs)("select",{className:"form-select",value:v,onChange:e=>f(e.target.value),children:[a.jsx("option",{value:"all",children:"All Status"}),a.jsx("option",{value:"draft",children:"Draft"}),a.jsx("option",{value:"submitted",children:"Submitted"}),a.jsx("option",{value:"reviewed",children:"Reviewed"}),a.jsx("option",{value:"approved",children:"Approved"}),a.jsx("option",{value:"rejected",children:"Rejected"})]})})]})})}),(0,a.jsxs)("div",{className:"card",children:[a.jsx("div",{className:"card-header",children:(0,a.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[a.jsx("h5",{className:"mb-0",children:"All Submissions"}),(0,a.jsxs)("span",{className:"badge bg-primary",children:[q.length," submissions"]})]})}),(0,a.jsxs)("div",{className:"card-body p-0",children:[a.jsx("div",{className:"table-responsive",children:(0,a.jsxs)("table",{className:"table table-hover mb-0",children:[a.jsx("thead",{className:"table-light",children:(0,a.jsxs)("tr",{children:[a.jsx("th",{children:"Student"}),a.jsx("th",{children:"Class"}),a.jsx("th",{children:"Assignment"}),a.jsx("th",{children:"Type"}),a.jsx("th",{children:"Submitted At"}),a.jsx("th",{children:"Status"}),a.jsx("th",{children:"Grade"}),a.jsx("th",{children:"Attachments"}),a.jsx("th",{children:"Actions"})]})}),a.jsx("tbody",{children:q.map(e=>(0,a.jsxs)("tr",{children:[a.jsx("td",{children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"fw-bold",children:[e.student?.firstName," ",e.student?.lastName]}),a.jsx("small",{className:"text-muted",children:e.student?.email})]})}),a.jsx("td",{children:e.student?.className?a.jsx("span",{className:"badge bg-secondary",children:e.student.className}):a.jsx("span",{className:"text-muted",children:"-"})}),(0,a.jsxs)("td",{children:[a.jsx("div",{className:"fw-semibold",children:e.task?.title}),(0,a.jsxs)("small",{className:"text-muted",children:["Max: ",e.task?.maxScore," pts"]})]}),a.jsx("td",{children:getTypeBadge(e.task?.type||"assignment")}),a.jsx("td",{children:a.jsx("small",{children:new Date(e.submittedAt).toLocaleString()})}),a.jsx("td",{children:getStatusBadge(e.status)}),a.jsx("td",{children:e.grade?(0,a.jsxs)("span",{className:"fw-bold text-success",children:[e.grade," / ",e.task?.maxScore]}):a.jsx("span",{className:"text-muted",children:"-"})}),a.jsx("td",{children:e.attachments&&e.attachments.length>0?(0,a.jsxs)("span",{className:"badge bg-secondary",children:[a.jsx("i",{className:"fas fa-paperclip me-1"}),e.attachments.length]}):a.jsx("span",{className:"text-muted",children:"-"})}),a.jsx("td",{children:(0,a.jsxs)("div",{className:"d-flex gap-1",children:[a.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:()=>handleViewSubmission(e),title:"View Details",children:a.jsx(o.Z,{size:14})}),a.jsx("button",{className:"btn btn-sm btn-outline-success",onClick:()=>handleStartReview(e),title:"Review & Grade",children:a.jsx(m.Z,{size:14})})]})})]},e.id))})]})}),0===q.length&&(0,a.jsxs)("div",{className:"text-center py-5",children:[a.jsx(d.Z,{size:48,className:"text-muted mb-3"}),a.jsx("h5",{children:"No submissions found"}),a.jsx("p",{className:"text-muted",children:"Try adjusting your filters"})]})]})]}),S&&w&&a.jsx("div",{className:"modal show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:a.jsx("div",{className:"modal-dialog modal-lg modal-dialog-scrollable",children:(0,a.jsxs)("div",{className:"modal-content",children:[(0,a.jsxs)("div",{className:"modal-header bg-primary text-white",children:[(0,a.jsxs)("h5",{className:"modal-title",children:[a.jsx(d.Z,{size:20,className:"me-2"}),"Submission Details"]}),a.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>k(!1)})]}),(0,a.jsxs)("div",{className:"modal-body",children:[(0,a.jsxs)("div",{className:"row mb-3",children:[(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("strong",{children:"Student:"})," ",w.student?.firstName," ",w.student?.lastName]}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("strong",{children:"Class:"})," ",w.student?.className||"-"]})]}),(0,a.jsxs)("div",{className:"row mb-3",children:[(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("strong",{children:"Assignment:"})," ",w.task?.title]}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("strong",{children:"Type:"})," ",getTypeBadge(w.task?.type||"assignment")]})]}),(0,a.jsxs)("div",{className:"row mb-3",children:[(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("strong",{children:"Submitted:"})," ",new Date(w.submittedAt).toLocaleString()]}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("strong",{children:"Status:"})," ",getStatusBadge(w.status)]})]}),a.jsx("hr",{}),(0,a.jsxs)("div",{className:"mb-3",children:[a.jsx("strong",{children:"Content:"}),a.jsx("div",{className:"p-3 bg-light rounded mt-2",children:w.content||a.jsx("em",{className:"text-muted",children:"No content provided"})})]}),w.attachments&&w.attachments.length>0&&(0,a.jsxs)("div",{className:"mb-3",children:[a.jsx("strong",{children:"Attachments:"}),a.jsx("div",{className:"list-group mt-2",children:w.attachments.map((e,s)=>(0,a.jsxs)("div",{className:"list-group-item d-flex justify-content-between align-items-center",children:[(0,a.jsxs)("div",{children:[a.jsx("i",{className:`fas ${e.mimetype?.includes("image")?"fa-image text-primary":e.mimetype?.includes("pdf")?"fa-file-pdf text-danger":"fa-file text-secondary"} me-2`}),a.jsx("span",{children:e.originalName}),(0,a.jsxs)("small",{className:"text-muted ms-2",children:["(",(e.size/1024).toFixed(2)," KB)"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("a",{href:`${g.CT}${e.url}`,target:"_blank",rel:"noopener noreferrer",className:"btn btn-sm btn-outline-primary me-2",children:[a.jsx(o.Z,{size:14,className:"me-1"})," View"]}),(0,a.jsxs)("a",{href:`${g.CT}${e.url}`,download:e.originalName,className:"btn btn-sm btn-outline-success",children:[a.jsx(h.Z,{size:14,className:"me-1"})," Download"]})]})]},s))})]}),w.grade&&(0,a.jsxs)("div",{className:"mb-3",children:[a.jsx("strong",{children:"Grade:"}),(0,a.jsxs)("span",{className:"fw-bold text-success ms-2",children:[w.grade," / ",w.task?.maxScore,"(",(w.grade/(w.task?.maxScore||1)*100).toFixed(1),"%)"]})]}),w.feedback&&(0,a.jsxs)("div",{className:"mb-3",children:[a.jsx("strong",{children:"Teacher Feedback:"}),a.jsx("div",{className:"p-3 bg-info bg-opacity-10 rounded mt-2",children:w.feedback})]})]}),(0,a.jsxs)("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>k(!1),children:"Close"}),(0,a.jsxs)("button",{type:"button",className:"btn btn-success",onClick:()=>{k(!1),handleStartReview(w)},children:[a.jsx(m.Z,{size:16,className:"me-2"}),"Review & Grade"]})]})]})})}),C&&w&&a.jsx("div",{className:"modal show d-block",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},onClick:()=>_(!1),children:a.jsx("div",{className:"modal-dialog modal-lg modal-dialog-centered",onClick:e=>e.stopPropagation(),children:(0,a.jsxs)("div",{className:"modal-content border-0 shadow-lg",children:[(0,a.jsxs)("div",{className:"modal-header bg-gradient",style:{background:"linear-gradient(135deg, #11998e 0%, #38ef7d 100%)"},children:[(0,a.jsxs)("h5",{className:"modal-title text-white fw-bold d-flex align-items-center gap-2",children:[a.jsx(x.Z,{size:24}),"Review & Grade Submission"]}),a.jsx("button",{type:"button",className:"btn-close btn-close-white",onClick:()=>_(!1)})]}),(0,a.jsxs)("div",{className:"modal-body",children:[a.jsx("div",{className:"card border-0 bg-light mb-3",children:a.jsx("div",{className:"card-body",children:(0,a.jsxs)("div",{className:"row",children:[(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("small",{className:"text-muted",children:"Student"}),(0,a.jsxs)("p",{className:"mb-0 fw-semibold",children:[w.student?.firstName," ",w.student?.lastName]}),a.jsx("small",{className:"text-muted",children:w.student?.email})]}),(0,a.jsxs)("div",{className:"col-md-6",children:[a.jsx("small",{className:"text-muted",children:"Assignment"}),a.jsx("p",{className:"mb-0 fw-semibold",children:w.task?.title}),(0,a.jsxs)("small",{className:"text-muted",children:["Max Score: ",w.task?.maxScore," pts"]})]})]})})}),a.jsx("div",{className:"card border-0 bg-light mb-3",children:(0,a.jsxs)("div",{className:"card-body",children:[a.jsx("small",{className:"text-muted",children:"Submission Content:"}),a.jsx("div",{className:"mt-2",style:{maxHeight:"150px",overflowY:"auto"},children:w.content||a.jsx("em",{className:"text-muted",children:"No content provided"})})]})}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("label",{className:"form-label fw-semibold d-flex align-items-center gap-2",children:[a.jsx(u.Z,{size:18,className:"text-warning"}),"Grade (out of ",w.task?.maxScore,") ",a.jsx("span",{className:"text-danger",children:"*"})]}),a.jsx("input",{type:"number",className:"form-control form-control-lg",min:"0",max:w.task?.maxScore,step:"0.5",value:A,onChange:e=>P(e.target.value),placeholder:"Enter grade"}),A&&(0,a.jsxs)("small",{className:"text-muted mt-1 d-block",children:["Percentage: ",(parseFloat(A)/(w.task?.maxScore||100)*100).toFixed(1),"%"]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[a.jsx("label",{className:"form-label fw-semibold",children:"Status"}),(0,a.jsxs)("select",{className:"form-select",value:F,onChange:e=>$(e.target.value),children:[a.jsx("option",{value:"reviewed",children:"Reviewed"}),a.jsx("option",{value:"approved",children:"Approved ✅"}),a.jsx("option",{value:"rejected",children:"Rejected ❌"}),a.jsx("option",{value:"resubmit",children:"Resubmit Required \uD83D\uDD04"})]})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("label",{className:"form-label fw-semibold d-flex align-items-center gap-2",children:[a.jsx(m.Z,{size:18,className:"text-info"}),"Feedback for Student"]}),a.jsx("textarea",{className:"form-control",rows:5,value:Z,onChange:e=>z(e.target.value),placeholder:"Provide detailed feedback to help the student improve..."}),a.jsx("small",{className:"text-muted",children:"This will be visible to the student"})]}),(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsxs)("label",{className:"form-label fw-semibold d-flex align-items-center gap-2",children:[a.jsx(d.Z,{size:18,className:"text-warning"}),"Private Notes (Optional)"]}),a.jsx("textarea",{className:"form-control",rows:3,value:R,onChange:e=>T(e.target.value),placeholder:"Add private notes for your reference (not visible to student)..."}),a.jsx("small",{className:"text-muted",children:"Only visible to school admins and teachers"})]})]}),(0,a.jsxs)("div",{className:"modal-footer",children:[a.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>_(!1),children:"Cancel"}),(0,a.jsxs)("button",{type:"button",className:"btn btn-success btn-lg",onClick:handleSubmitReview,children:[a.jsx(b.Z,{size:18,className:"me-2"}),"Submit Review"]})]})]})})})]})}},83085:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>n,__esModule:()=>i,default:()=>d});var a=t(95153);let l=(0,a.createProxy)(String.raw`C:\xampp\htdocs\childclub\childclub-frontend\src\app\school-admin\submissions\page.tsx`),{__esModule:i,$$typeof:n}=l,r=l.default,d=r}};var s=require("../../../webpack-runtime.js");s.C(e);var __webpack_exec__=e=>s(s.s=e),t=s.X(0,[659,1336,9675,3528,4301,4154,9300,710,4357,656,5525,7565],()=>__webpack_exec__(9673));module.exports=t})();